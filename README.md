# LED Brightness Control

Проект для управления яркостью светодиодного освещения и дискретными выходами в распределённой сети узлов на базе **STM32F103** с центральным приложением на **Qt (C++)**.

## Что делает проект

Система состоит из двух частей:

- **`Control_MC/`** — прошивка микроконтроллерного узла (STM32), который управляет выходами, ШИМ-каналами и читает датчики.
- **`Control_PC/`** — настольное приложение оператора, которое подключается по UART к master-узлу, отображает состояния и отправляет команды.

Передача между узлами идёт по **CAN**, а связь ПК с сетью узлов — через **UART** (через master-узел).

## Используемые технологии

### Встраиваемая часть (`Control_MC`)

- **MCU:** STM32F1 (STM32F103)
- **Framework:** STM32 HAL + CMSIS
- **Интерфейсы:**
  - CAN (обмен между узлами)
  - UART (обмен с ПК)
  - I2C (датчик освещённости BH1750)
  - ADC + DMA (измерение аналоговых сигналов)
  - TIM/PWM (управление яркостью каналов)

### ПК-приложение (`Control_PC`)

- **Язык:** C++
- **GUI:** Qt Widgets
- **Сериал-порт:** `QSerialPort`
- **Данные и логика:** Qt JSON/контейнеры/таймеры (`QTimer`)
- **Сборка:** `.pro` (qmake) + Visual Studio проектные файлы

### Протокол

- Общие коды команд и размер пакета вынесены в `general/id.h`.
- Базовый размер пакета: **6 байт**.
- Поддерживаемые команды: инициализация, управление OUT1..OUT4, PWM1..PWM3, чтение ADC/LUX, групповая установка PWM, сигнал CONNECTED и др.

## Как работает система

1. После старта узел STM32 инициализирует периферию (GPIO, DMA, TIM, ADC, I2C, CAN, USART).
2. Узел запускает CAN, PWM, ADC+DMA, UART приём и инициализацию BH1750.
3. ПК-приложение подключается к COM-порту, получает/отправляет 6-байтовые пакеты команд.
4. Master-узел маршрутизирует данные между UART (ПК) и CAN (узлы сети).
5. Узлы обрабатывают команды:
   - переключают дискретные выходы,
   - устанавливают уровни PWM,
   - отдают значения ADC,
   - читают освещённость с BH1750 и отправляют LUX.
6. ПК-приложение обновляет UI: состояния входов/выходов, значения PWM, напряжения ADC и освещённость.

Дополнительно в ПК-приложении реализован режим автоматизации (реакция на входы/движение и освещённость) с использованием таймеров.

## Структура репозитория

- `Control_MC/` — прошивка STM32
- `Control_PC/` — desktop-приложение Qt
- `general/` — общий заголовок с кодами протокола (`id.h`)
